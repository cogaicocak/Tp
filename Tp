
-- Smart Island Teleporter (RESET TR∆Ø·ªöC - TP TRONG L√öC RESET)
-- ƒê·∫∑t script n√†y v√†o StarterGui ho·∫∑c StarterPlayerScripts

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- Danh s√°ch c√°c ƒë·∫£o v·ªõi emoji
local islands = {
    {name = "Port Town", position = Vector3.new(-378.27, 20.87, 5537.93), emoji = "‚öì"},
    {name = "Peanut Island", position = Vector3.new(-2158.17, 38.36, -10193.24), emoji = "ü•ú"},
    {name = "Icecream Island", position = Vector3.new(-863.93, 66.08, -11019.04), emoji = "üç¶"},
    {name = "Tiki", position = Vector3.new(-16228.08, 9.32, 412.53), emoji = "üóø"},
    {name = "Haunted Castle", position = Vector3.new(-9506.11, 142.36, 5526.04), emoji = "üëª"},
    {name = "CakeLoaf", position = Vector3.new(-2145.42, 38.06, -11895.08), emoji = "üç∞"},
    {name = "Castle On The Sea", position = Vector3.new(-4999.45, 314.78, -3010.54), emoji = "üè∞"},
    {name = "Great Tree", position = Vector3.new(2178.69, 21.92, -6904.10), emoji = "üå≥"},
    {name = "Mansion", position = Vector3.new(-12507.32, 337.17, -7470.36), emoji = "üèõÔ∏è"}
}

-- C√†i ƒë·∫∑t
local SPAM_DURATION = 2.5 -- Spam trong 2.5 gi√¢y
local MAX_DIRECT_TP_DISTANCE = 8000

-- T·∫°o GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "IslandTeleportGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Frame ch√≠nh
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 320, 0, 500)
mainFrame.Position = UDim2.new(0.5, -160, 0.5, -250)
mainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

local mainStroke = Instance.new("UIStroke")
mainStroke.Color = Color3.fromRGB(70, 70, 90)
mainStroke.Thickness = 2
mainStroke.Parent = mainFrame

-- Title
local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "Title"
titleLabel.Size = UDim2.new(1, 0, 0, 50)
titleLabel.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
titleLabel.BorderSizePixel = 0
titleLabel.Text = "üèùÔ∏è Island Teleporter"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextSize = 20
titleLabel.Font = Enum.Font.GothamBold
titleLabel.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 12)
titleCorner.Parent = titleLabel

-- Close Button
local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 40, 0, 40)
closeButton.Position = UDim2.new(1, -45, 0, 5)
closeButton.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
closeButton.BorderSizePixel = 0
closeButton.Text = "‚úï"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.TextSize = 20
closeButton.Font = Enum.Font.GothamBold
closeButton.Parent = mainFrame

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 8)
closeCorner.Parent = closeButton

-- Status Label
local statusLabel = Instance.new("TextLabel")
statusLabel.Name = "StatusLabel"
statusLabel.Size = UDim2.new(1, -20, 0, 30)
statusLabel.Position = UDim2.new(0, 10, 0, 55)
statusLabel.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
statusLabel.BorderSizePixel = 0
statusLabel.Text = "Ready to teleport"
statusLabel.TextColor3 = Color3.fromRGB(150, 255, 150)
statusLabel.TextSize = 14
statusLabel.Font = Enum.Font.GothamMedium
statusLabel.Visible = false
statusLabel.Parent = mainFrame

local statusCorner = Instance.new("UICorner")
statusCorner.CornerRadius = UDim.new(0, 8)
statusCorner.Parent = statusLabel

-- ScrollingFrame
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Name = "IslandList"
scrollFrame.Size = UDim2.new(1, -20, 1, -70)
scrollFrame.Position = UDim2.new(0, 10, 0, 60)
scrollFrame.BackgroundTransparency = 1
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 6
scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 120)
scrollFrame.Parent = mainFrame

local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 8)
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Parent = scrollFrame

-- Bi·∫øn ki·ªÉm so√°t
local isTeleporting = false

-- H√†m t√¨m ƒë·∫£o trung gian g·∫ßn nh·∫•t
local function findIntermediateIsland(startPos, targetPos, excludeIslands)
    local minDistance = math.huge
    local bestIsland = nil
    
    for _, island in ipairs(islands) do
        local skip = false
        for _, excluded in ipairs(excludeIslands) do
            if island.name == excluded then
                skip = true
                break
            end
        end
        
        if not skip then
            local distanceFromStart = (island.position - startPos).Magnitude
            local distanceToTarget = (island.position - targetPos).Magnitude
            
            if distanceToTarget < (targetPos - startPos).Magnitude then
                local totalDistance = distanceFromStart + distanceToTarget
                if totalDistance < minDistance then
                    minDistance = totalDistance
                    bestIsland = island
                end
            end
        end
    end
    
    return bestIsland
end

-- H√†m c·∫≠p nh·∫≠t status
local function updateStatus(text, color)
    statusLabel.Text = text
    statusLabel.TextColor3 = color or Color3.fromRGB(255, 255, 255)
    statusLabel.Visible = true
end

-- H√ÄM RESET TR∆Ø·ªöC R·ªíI SPAM TP (ƒê√öNG C√ÅCH)
local function resetFirstThenSpamTP(position)
    local character = player.Character
    if not character then return false end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid then return false end
    
    -- L∆ØU L·∫†I V·ªä TR√ç C·∫¶N TP
    local targetPos = position
    
    -- B∆Ø·ªöC 1: B·∫ÆT ƒê·∫¶U SPAM TP THREAD (nh∆∞ng ch∆∞a ch·∫°y)
    local spamActive = true
    local connections = {}
    
    -- H√†m spam TP t·∫•t c·∫£ parts
    local function spamTPAllParts()
        local char = player.Character
        if not char then return end
        
        for _, part in pairs(char:GetChildren()) do
            if part:IsA("BasePart") then
                pcall(function()
                    part.CFrame = CFrame.new(targetPos)
                    part.Velocity = Vector3.new(0, 0, 0)
                    part.RotVelocity = Vector3.new(0, 0, 0)
                    part.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                    part.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
                end)
            end
        end
        
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if hrp then
            pcall(function()
                hrp.CFrame = CFrame.new(targetPos)
                hrp.Velocity = Vector3.new(0, 0, 0)
                hrp.RotVelocity = Vector3.new(0, 0, 0)
                hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                hrp.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
            end)
        end
    end
    
    -- B∆Ø·ªöC 2: B·∫ÆT ƒê·∫¶U SPAM TP THREADS
    local startTime = tick()
    
    -- Thread 1: Heartbeat
    local heartbeatConn = RunService.Heartbeat:Connect(function()
        if not spamActive or tick() - startTime > SPAM_DURATION then
            return
        end
        spamTPAllParts()
    end)
    table.insert(connections, heartbeatConn)
    
    -- Thread 2: RenderStepped
    local renderConn = RunService.RenderStepped:Connect(function()
        if not spamActive or tick() - startTime > SPAM_DURATION then
            return
        end
        spamTPAllParts()
    end)
    table.insert(connections, renderConn)
    
    -- Thread 3: Stepped
    local steppedConn = RunService.Stepped:Connect(function()
        if not spamActive or tick() - startTime > SPAM_DURATION then
            return
        end
        spamTPAllParts()
    end)
    table.insert(connections, steppedConn)
    
    -- Thread 4: Task spam
    task.spawn(function()
        while spamActive and tick() - startTime < SPAM_DURATION do
            spamTPAllParts()
            task.wait()
        end
    end)
    
    -- Thread 5: Task spam 2
    task.spawn(function()
        while spamActive and tick() - startTime < SPAM_DURATION do
            spamTPAllParts()
            RunService.Heartbeat:Wait()
        end
    end)
    
    -- B∆Ø·ªöC 3: RESET NGAY SAU KHI ƒê√É B·∫ÆT ƒê·∫¶U SPAM
    task.wait(0.05) -- ƒê·ª£i 1 ch√∫t ƒë·ªÉ spam threads b·∫Øt ƒë·∫ßu
    humanoid.Health = 0
    print("üíÄ ƒê√£ reset character - spam TP ƒëang ch·∫°y...")
    
    -- B∆Ø·ªöC 4: ƒê·ª¢I RESPAWN v√† ti·∫øp t·ª•c spam
    player.CharacterAdded:Wait()
    print("‚úÖ Character respawned - v·∫´n ƒëang spam TP...")
    
    -- ƒê·ª£i HRP
    local newChar = player.Character
    if newChar then
        newChar:WaitForChild("HumanoidRootPart")
    end
    
    -- Ti·∫øp t·ª•c spam th√™m ch√∫t
    task.wait(0.5)
    
    -- B∆Ø·ªöC 5: D·ª™NG SPAM
    spamActive = false
    for _, conn in pairs(connections) do
        if conn and conn.Connected then
            conn:Disconnect()
        end
    end
    
    print("üõë D·ª´ng spam TP")
    
    return true
end

-- H√ÄM RESET V√Ä SPAM TP V·ªöI ƒê·ª¢I (cho intermediate hops)
local function resetSpamTPWithWait(position)
    resetFirstThenSpamTP(position)
    task.wait(0.5) -- ƒê·ª£i ·ªïn ƒë·ªãnh
    return true
end

-- H√†m ch√≠nh teleport v·ªõi multi-hop
local function smartTeleport(targetIsland)
    if isTeleporting then
        warn("‚ö†Ô∏è ƒêang teleport, vui l√≤ng ƒë·ª£i!")
        return
    end
    
    isTeleporting = true
    
    local character = player.Character
    if not character then
        isTeleporting = false
        return
    end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then
        isTeleporting = false
        return
    end
    
    local startPos = humanoidRootPart.Position
    local targetPos = targetIsland.position
    local distance = (targetPos - startPos).Magnitude
    
    print("üöÄ B·∫Øt ƒë·∫ßu teleport ƒë·∫øn: " .. targetIsland.name)
    print("üìè Kho·∫£ng c√°ch: " .. math.floor(distance) .. " studs")
    
    -- N·∫øu kho·∫£ng c√°ch ng·∫Øn, TP tr·ª±c ti·∫øp
    if distance <= MAX_DIRECT_TP_DISTANCE then
        updateStatus("üíÄ Resetting & spam TP to " .. targetIsland.name .. "...", Color3.fromRGB(100, 200, 255))
        
        -- RESET TR∆Ø·ªöC R·ªíI SPAM TP
        resetFirstThenSpamTP(targetPos)
        
        task.wait(1)
        updateStatus("‚úÖ Arrived at " .. targetIsland.name, Color3.fromRGB(150, 255, 150))
        task.wait(2)
        statusLabel.Visible = false
        isTeleporting = false
    else
        -- C·∫ßn ƒë·∫£o trung gian
        updateStatus("üîç Finding route to " .. targetIsland.name .. "...", Color3.fromRGB(255, 200, 100))
        
        local currentPos = startPos
        local excludedIslands = {targetIsland.name}
        local hops = {}
        
        -- T√¨m t·ªëi ƒëa 3 ƒë·∫£o trung gian
        while (targetPos - currentPos).Magnitude > MAX_DIRECT_TP_DISTANCE and #hops < 3 do
            local intermediateIsland = findIntermediateIsland(currentPos, targetPos, excludedIslands)
            
            if intermediateIsland then
                table.insert(hops, intermediateIsland)
                table.insert(excludedIslands, intermediateIsland.name)
                currentPos = intermediateIsland.position
                print("üõë ƒêi·ªÉm d·ª´ng: " .. intermediateIsland.name)
            else
                break
            end
        end
        
        -- Th·ª±c hi·ªán teleport qua c√°c ƒëi·ªÉm trung gian
        for i, hopIsland in ipairs(hops) do
            updateStatus(string.format("üíÄ Reset & spam %d/%d: %s", i, #hops, hopIsland.name), Color3.fromRGB(255, 200, 100))
            
            -- RESET TR∆Ø·ªöC R·ªíI SPAM TP
            resetSpamTPWithWait(hopIsland.position)
        end
        
        -- TP ƒë·∫øn ƒë√≠ch cu·ªëi c√πng
        updateStatus("üíÄ Final reset & spam to " .. targetIsland.name .. "...", Color3.fromRGB(100, 200, 255))
        
        -- RESET TR∆Ø·ªöC R·ªíI SPAM TP ƒë·∫øn ƒë√≠ch
        resetFirstThenSpamTP(targetPos)
        
        task.wait(1)
        updateStatus("‚úÖ Arrived at " .. targetIsland.name .. " (" .. (#hops + 1) .. " hops)", Color3.fromRGB(150, 255, 150))
        task.wait(3)
        statusLabel.Visible = false
        isTeleporting = false
    end
    
    print("‚úÖ Teleport ho√†n t·∫•t!")
end

-- T·∫°o button cho m·ªói ƒë·∫£o
for i, island in ipairs(islands) do
    local islandButton = Instance.new("TextButton")
    islandButton.Name = island.name
    islandButton.Size = UDim2.new(1, -10, 0, 55)
    islandButton.BackgroundColor3 = Color3.fromRGB(50, 50, 65)
    islandButton.BorderSizePixel = 0
    islandButton.AutoButtonColor = false
    islandButton.Text = ""
    islandButton.Parent = scrollFrame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 10)
    buttonCorner.Parent = islandButton
    
    local buttonStroke = Instance.new("UIStroke")
    buttonStroke.Color = Color3.fromRGB(70, 70, 90)
    buttonStroke.Thickness = 1
    buttonStroke.Transparency = 0.5
    buttonStroke.Parent = islandButton
    
    -- Emoji
    local emojiLabel = Instance.new("TextLabel")
    emojiLabel.Size = UDim2.new(0, 45, 1, 0)
    emojiLabel.Position = UDim2.new(0, 5, 0, 0)
    emojiLabel.BackgroundTransparency = 1
    emojiLabel.Text = island.emoji
    emojiLabel.TextSize = 28
    emojiLabel.Parent = islandButton
    
    -- T√™n ƒë·∫£o
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, -55, 1, 0)
    nameLabel.Position = UDim2.new(0, 50, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = island.name
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextSize = 16
    nameLabel.Font = Enum.Font.GothamSemibold
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Parent = islandButton
    
    -- Hover effect
    islandButton.MouseEnter:Connect(function()
        if not isTeleporting then
            TweenService:Create(islandButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(70, 70, 90)}):Play()
            TweenService:Create(buttonStroke, TweenInfo.new(0.2), {Thickness = 2, Transparency = 0}):Play()
        end
    end)
    
    islandButton.MouseLeave:Connect(function()
        TweenService:Create(islandButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 65)}):Play()
        TweenService:Create(buttonStroke, TweenInfo.new(0.2), {Thickness = 1, Transparency = 0.5}):Play()
    end)
    
    -- Click handler
    islandButton.MouseButton1Click:Connect(function()
        if not isTeleporting then
            TweenService:Create(islandButton, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(80, 180, 80)}):Play()
            smartTeleport(island)
            task.wait(0.3)
            TweenService:Create(islandButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 65)}):Play()
        end
    end)
end

-- C·∫≠p nh·∫≠t canvas size
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 10)
listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 10)
end)

-- Close button
closeButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)

-- Draggable frame
local dragging, dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

titleLabel.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

titleLabel.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

print("‚úÖ Smart Island Teleporter ƒë√£ load! (RESET FIRST - SPAM DURING RESET)")
