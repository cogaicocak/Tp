
-- LocalScript ƒë·∫∑t trong StarterGui ho·∫∑c StarterPlayerScripts

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- Danh s√°ch c√°c ƒë·∫£o
local islands = {
    {name = "Peanut Island", position = Vector3.new(-2158.17, 38.36, -10193.24)},
    {name = "Icecream Island", position = Vector3.new(-863.93, 66.08, -11019.04)},
    {name = "Tiki", position = Vector3.new(-16228.08, 9.32, 412.53)},
    {name = "Haunted Castle", position = Vector3.new(-9506.11, 142.36, 5526.04)},
    {name = "CakeLoaf", position = Vector3.new(-2145.42, 38.06, -11895.08)},
    {name = "Castle On The Sea", position = Vector3.new(-4999.45, 314.78, -3010.54)}
}

local tweenSpeed = 350
local isTweening = false
local flyHeight = 300 -- ƒê·ªô cao bay (studs)

-- T·∫°o ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "IslandTeleportGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- T·∫°o Frame ch√≠nh
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 300, 0, 450)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -225)
mainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- Bo g√≥c cho frame
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = mainFrame

-- T·∫°o ti√™u ƒë·ªÅ
local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "Title"
titleLabel.Size = UDim2.new(1, 0, 0, 50)
titleLabel.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
titleLabel.BorderSizePixel = 0
titleLabel.Text = "üèùÔ∏è Island Teleport"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 20
titleLabel.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 10)
titleCorner.Parent = titleLabel

-- T·∫°o ScrollingFrame cho danh s√°ch ƒë·∫£o
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Name = "IslandList"
scrollFrame.Size = UDim2.new(1, -20, 1, -110)
scrollFrame.Position = UDim2.new(0, 10, 0, 60)
scrollFrame.BackgroundTransparency = 1
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 6
scrollFrame.Parent = mainFrame

-- Layout cho c√°c button
local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 8)
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Parent = scrollFrame

-- H√†m tween m∆∞·ª£t v·ªõi ƒë∆∞·ªùng bay cong
local function tweenToIsland(targetPosition)
    if isTweening then
        isTweening = false
        wait(0.1)
    end
    
    isTweening = true
    
    -- L·∫•y character v√† HumanoidRootPart m·ªõi nh·∫•t
    character = player.Character
    if not character then 
        isTweening = false
        return 
    end
    
    humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    local humanoid = character:FindFirstChild("Humanoid")
    
    if not humanoidRootPart or not humanoid then 
        isTweening = false
        return 
    end
    
    -- T·∫Øt gravity v√† collision ƒë·ªÉ tr√°nh gi·∫≠t
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(0, 0, 0)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = humanoidRootPart
    
    local bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    bodyGyro.P = 10000
    bodyGyro.D = 500
    bodyGyro.CFrame = humanoidRootPart.CFrame
    bodyGyro.Parent = humanoidRootPart
    
    -- V√¥ hi·ªáu h√≥a collision
    for _, part in pairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end
    
    -- T√≠nh to√°n 3 ƒëi·ªÉm: Start -> Peak (cao) -> End
    local startPos = humanoidRootPart.Position
    local endPos = targetPosition
    
    -- T√≠nh ƒëi·ªÉm cao nh·∫•t (peak) ·ªü gi·ªØa h√†nh tr√¨nh
    local midPoint = (startPos + endPos) / 2
    local peakPos = Vector3.new(midPoint.X, math.max(startPos.Y, endPos.Y) + flyHeight, midPoint.Z)
    
    -- T√≠nh t·ªïng qu√£ng ƒë∆∞·ªùng (bay theo ƒë∆∞·ªùng cong)
    local dist1 = (peakPos - startPos).Magnitude
    local dist2 = (endPos - peakPos).Magnitude
    local totalDistance = dist1 + dist2
    local duration = totalDistance / tweenSpeed
    
    print("ƒêang bay ƒë·∫øn ƒë·∫£o... (" .. math.floor(totalDistance) .. " studs, " .. math.floor(duration) .. "s)")
    
    -- Tween m∆∞·ª£t b·∫±ng RunService v·ªõi ƒë∆∞·ªùng cong Bezier
    local RunService = game:GetService("RunService")
    local startTime = tick()
    local connection
    
    connection = RunService.Heartbeat:Connect(function()
        if not isTweening then
            connection:Disconnect()
            bodyVelocity:Destroy()
            bodyGyro:Destroy()
            -- Kh√¥i ph·ª•c collision
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = true
                end
            end
            return
        end
        
        local elapsed = tick() - startTime
        local alpha = math.min(elapsed / duration, 1)
        
        -- Easing function (Sine InOut cho m∆∞·ª£t h∆°n)
        local easedAlpha = alpha < 0.5 
            and 2 * alpha * alpha 
            or 1 - math.pow(-2 * alpha + 2, 2) / 2
        
        -- T√≠nh v·ªã tr√≠ theo ƒë∆∞·ªùng cong Quadratic Bezier (3 ƒëi·ªÉm)
        -- B(t) = (1-t)¬≤P0 + 2(1-t)tP1 + t¬≤P2
        local t = easedAlpha
        local oneMinusT = 1 - t
        
        local currentPos = 
            oneMinusT * oneMinusT * startPos +
            2 * oneMinusT * t * peakPos +
            t * t * endPos
        
        -- T√≠nh h∆∞·ªõng nh√¨n (lookAt next point)
        local nextT = math.min(t + 0.01, 1)
        local nextOneMinusT = 1 - nextT
        local nextPos = 
            nextOneMinusT * nextOneMinusT * startPos +
            2 * nextOneMinusT * nextT * peakPos +
            nextT * nextT * endPos
        
        -- Di chuy·ªÉn m∆∞·ª£t
        local lookAtCFrame = CFrame.new(currentPos, nextPos)
        humanoidRootPart.CFrame = lookAtCFrame
        bodyGyro.CFrame = lookAtCFrame
        
        -- K·∫øt th√∫c
        if alpha >= 1 then
            connection:Disconnect()
            humanoidRootPart.CFrame = CFrame.new(endPos)
            bodyVelocity:Destroy()
            bodyGyro:Destroy()
            
            -- Kh√¥i ph·ª•c collision
            task.wait(0.1)
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = true
                end
            end
            
            isTweening = false
            print("ƒê√£ ƒë·∫øn ƒë·∫£o!")
        end
    end)
end

-- T·∫°o button cho m·ªói ƒë·∫£o
for i, island in ipairs(islands) do
    local button = Instance.new("TextButton")
    button.Name = island.name
    button.Size = UDim2.new(1, -10, 0, 45)
    button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    button.BorderSizePixel = 0
    button.Text = island.name
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.Gotham
    button.TextSize = 16
    button.AutoButtonColor = false
    button.Parent = scrollFrame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 8)
    buttonCorner.Parent = button
    
    -- Hi·ªáu ·ª©ng hover
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    end)
    
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end)
    
    -- Click ƒë·ªÉ tween
    button.MouseButton1Click:Connect(function()
        tweenToIsland(island.position)
        button.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
        wait(0.2)
        button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    end)
end

-- C·∫≠p nh·∫≠t canvas size
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 10)
listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 10)
end)

-- T·∫°o n√∫t ƒë√≥ng
local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -35, 0, 10)
closeButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
closeButton.BorderSizePixel = 0
closeButton.Text = "‚úï"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 18
closeButton.Parent = mainFrame

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(1, 0)
closeCorner.Parent = closeButton

closeButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)

-- N√∫t Stop
local stopButton = Instance.new("TextButton")
stopButton.Name = "StopButton"
stopButton.Size = UDim2.new(0.48, 0, 0, 35)
stopButton.Position = UDim2.new(0, 10, 1, -45)
stopButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
stopButton.BorderSizePixel = 0
stopButton.Text = "‚èπ STOP"
stopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
stopButton.Font = Enum.Font.GothamBold
stopButton.TextSize = 14
stopButton.Parent = mainFrame

local stopCorner = Instance.new("UICorner")
stopCorner.CornerRadius = UDim.new(0, 8)
stopCorner.Parent = stopButton

stopButton.MouseButton1Click:Connect(function()
    isTweening = false
    print("ƒê√£ d·ª´ng tween!")
end)

-- Label hi·ªÉn th·ªã ƒë·ªô cao bay
local heightLabel = Instance.new("TextLabel")
heightLabel.Name = "HeightLabel"
heightLabel.Size = UDim2.new(0.48, 0, 0, 35)
heightLabel.Position = UDim2.new(0.52, 0, 1, -45)
heightLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
heightLabel.BorderSizePixel = 0
heightLabel.Text = "High: " .. flyHeight
heightLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
heightLabel.Font = Enum.Font.Gotham
heightLabel.TextSize = 14
heightLabel.Parent = mainFrame

local heightCorner = Instance.new("UICorner")
heightCorner.CornerRadius = UDim.new(0, 8)
heightCorner.Parent = heightLabel

-- K√©o th·∫£ GUI
local dragging = false
local dragInput, mousePos, framePos

titleLabel.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        mousePos = input.Position
        framePos = mainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

titleLabel.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - mousePos
        mainFrame.Position = UDim2.new(
            framePos.X.Scale,
            framePos.X.Offset + delta.X,
            framePos.Y.Scale,
            framePos.Y.Offset + delta.Y
        )
    end
end)

-- C·∫≠p nh·∫≠t character khi respawn
player.CharacterAdded:Connect(function(char)
    character = char
    humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    isTweening = false
end)

print("Island Teleport GUI ƒë√£ ƒë∆∞·ª£c t·∫£i! (Smooth Curve Flight)")
```
